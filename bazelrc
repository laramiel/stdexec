# Enable using platform specific build settings
build --enable_platform_specific_config

# Use platforms to select toolchains (https://github.com/bazelbuild/bazel/issues/7260)
build --incompatible_enable_cc_toolchain_resolution

build:macos --config=generic_clang

# ASAN (address sanitizer)
# https://clang.llvm.org/docs/AddressSanitizer.html
build:asan --cc_output_directory_tag=asan
build:asan --config=sanitizer
build:asan --copt=-DADDRESS_SANITIZER
build:asan --copt=-fsanitize-address-use-after-scope
build:asan --copt=-fsanitize=address
build:asan --copt=-fsanitize=float-divide-by-zero
build:asan --copt=-fsanitize=nullability
build:asan --copt=-fsanitize=undefined
build:asan --features=asan
build:asan --linkopt=-fsanitize-link-c++-runtime
build:asan --linkopt=-fsanitize=address

# MSAN (memory sanitizer)
# https://clang.llvm.org/docs/MemorySanitizer.html
build:msan --cc_output_directory_tag=msan
build:msan --config=sanitizer
build:msan --copt=-DMEMORY_SANITIZER
build:msan --copt=-fsanitize-memory-track-origins
build:msan --copt=-fsanitize=memory
build:msan --features=msan
build:msan --linkopt=-fsanitize=memory

# Generic sanitizer
build:sanitizer --strip=never
build:sanitizer --force_ignore_dash_static
build:sanitizer --test_timeout=120,600,1800,-1
build:sanitizer --copt=-fno-omit-frame-pointer
build:sanitizer --copt=-gmlt
build:sanitizer --config=generic_clang


# Generic clang options
build:generic_clang --cxxopt=-std=c++20 --host_cxxopt=-std=c++20
build:generic_clang --copt=-fexceptions

# Warnings are errors
build:generic_clang --copt=-Werror --host_copt=-Werror

# ... but not in third-party/host mode
build:generic_clang --per_file_copt=external/.*@-w
build:generic_clang --host_copt=-w


# Some test methods are unused.

build:generic_clang --copt=-Wno-unused-function
